parameters:
  cert_manager:
    namespace: cert-manager
    charts:
      cert-manager: v0.11.0
    letsencrypt_email: REPLACEME

  kapitan:
    dependencies:
    - type: https
      source: https://charts.jetstack.io/charts/cert-manager-${cert_manager:charts:cert-manager}.tgz
      unpack: True
      output_path: dependencies/cert-manager/helmcharts
    - type: https
      source: https://raw.githubusercontent.com/jetstack/cert-manager/${cert_manager:charts:cert-manager}/deploy/manifests/00-crds.yaml
      output_path: dependencies/cert-manager/manifests/00-crds.yaml

    compile:
      - output_path: cert-manager/00_manifests
        input_type: jinja2
        input_paths:
          - cert-manager/manifests
      - output_path: cert-manager/01_helmchart
        input_type: helm
        input_paths:
          - cert-manager/helmcharts/cert-manager
        helm_values:
          prometheus:
            servicemonitor:
              enabled: true
        helm_params:
          release_name: cert-manager
          namespace: ${cert_manager:namespace}
      - output_path: cert-manager/02_issuers
        input_type: jsonnet
        output_type: yaml
        input_paths:
          - cert-manager/component/main.jsonnet
